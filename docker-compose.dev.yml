version: "3.8"

services:
  # --- 1. THE GATEWAY (Nginx Proxy) ---
  gateway:
    build: ./apps/gateway
    container_name: sv-gateway-dev
    restart: unless-stopped
    ports:
      - "8080:80" # Maps to the "Web Preview" in Google IDX
    volumes:
      - ./apps/gateway/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./data/cache:/var/cache/nginx/streamvault
    depends_on:
      - manager
      - web
    networks:
      - sv-internal

  # --- 2. THE BRAIN (Manager API) ---
  manager:
    build: ./apps/manager
    container_name: sv-manager-dev
    environment:
      - MODE=DEV
    env_file: .env
    volumes:
      - ./apps/manager:/app
      - ./data/sessions:/app/sessions
      - /var/run/docker.sock:/var/run/docker.sock # For Matrix Logs
    networks:
      - sv-internal

  # --- 3. THE FACE (Next.js - Prepared for later) ---
  web:
    image: node:20-alpine # Using image instead of build for now as web folder is empty
    container_name: sv-web-dev
    command: ["sh", "-c", "echo 'NextJS Placeholder' && tail -f /dev/null"]
    networks:
      - sv-internal

networks:
  sv-internal:
    driver: bridge